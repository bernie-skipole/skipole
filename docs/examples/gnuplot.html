<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>Index</title>
<link href="/skipole/css/w3.css" type="text/css" rel="stylesheet" />
<link href="/skipole/css/w3-theme-ski.css" type="text/css" rel="stylesheet" />
</head>
<body class="w3-theme">
<div class="w3-container w3-theme-d1">
<p>
<img src="/skipole/images/logo.svg" height="28" width="56" align="bottom" />
&nbsp;Skipole WSGI generator.
</p>
</div>
<div style="width:250px" class="w3-sidebar w3-bar-block w3-collapse w3-card w3-animate-left w3-theme-l1 w3-container" id="mySidebar">
<button class="w3-bar-item w3-button w3-large w3-hide-large" onclick="w3_close()">Close &times;</button>
<p>Topics:</p>
 <div class="w3-bar-block w3-black">
  <a href="/skipole/index.html" class="w3-bar-item w3-button w3-blue">Introduction</a>
  <a href="/skipole/getting_started.html" class="w3-bar-item w3-button">Getting Started</a>
  <a href="/skipole/pythoncode.html" class="w3-bar-item w3-button">Your Code</a>
  <a href="/skipole/startcall.html" class="w3-bar-item w3-button">start_call</a>
  <a href="/skipole/submitdata.html" class="w3-bar-item w3-button">submit_data</a>
  <a href="/skipole/endcall.html" class="w3-bar-item w3-button">end_call</a>
  <a href="/skipole/pagedata.html" class="w3-bar-item w3-button">PageData</a>
  <a href="/skipole/sectiondata.html" class="w3-bar-item w3-button">SectionData</a>
  <a href="/skipole/skicall.html" class="w3-bar-item w3-button">skicall</a>
  <a href="/skipole/servers/index.html" class="w3-bar-item w3-button">Serving wsgi</a>
  <a href="/skipole/examples/index.html" class="w3-bar-item w3-button">Code Examples</a>
</div>
<p>Development at GitHub:</p>
 <div class="w3-bar-block w3-black">
  <a href="https://github.com/bernie-skipole/skipole/" class="w3-bar-item w3-button">github.com/bernie-skipole/skipole</a>
</div>
</div>
<div class="w3-main" style="margin-left:250px">
<div class="w3-container  w3-section">
<button class="w3-button w3-xlarge w3-hide-large w3-black" onclick="w3_open()">&#9776; Menu</button>
<h3>Using Gnuplot to serve an svg image chart</h3>
<p>Ensure your server has gnuplot installed.</p>
<p>Create a directory, and move to it, then create a skipole project "myproj", note the trailing space dot, for current directory.</p>
<p>python -m skipole myproj .</p>
<p>which creates the file myproj.py in your current directory.</p>
<p>Edit the start of your myproj.py file to include the import:</p>
<pre>

import subprocess

</pre>

<p>Run the project and use skiadmin to create a SubmitIterator responder, with a name such as 'chart.svg'. Calling this from the browser will call your submit_data function which should return a binary iterator.</p>

<p>So a submit_data function such as this will do the job:</p>

<pre>

def submit_data(skicall):
    """This function is called when a Responder wishes to submit data for processing in some manner
       Typically you would create a PageData object containing widget,field values and call the
       skicall.update method, where the data will be applied to the page returned"""
    result = linechart()
    pd = PageData()
    pd.mimetype = 'image/svg+xml'
    skicall.update(pd)
    return [result]


def linechart():
    "Create an SVG line chart, return svg code as a bytes string"
    # data to plot
    dataset = ((0, 1), (1, 2), (2, 3))
    datastring = "\n".join(f"{x} {y}" for x,y in dataset)
    # commands to plot the points
    commands = ['set title "line.svg"',
                'set key off',
                'plot "-" with lines'
               ]
    return svgplot(commands, datastring)


def svgplot(commands, datastring):
    "Call gnuplot with commands, and datastring returns svg bytes"
    commandstring = "set terminal svg;" + ";".join(commands)
    args = ["gnuplot", "-e", commandstring]
    result = subprocess.check_output(args, input=datastring.encode("utf-8"), timeout=2)
    return result

 
</pre>
<p>When chart.svg is called, this submit_data function returns the svg code and the image is served to the client.</p>
</div>
</div>
<script>
function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
}
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
}
</script>
</body>
</html>
